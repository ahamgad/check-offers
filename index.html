<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #FCFCFC;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
    
    }
    #cards {
      width: 100%;
      max-width: 400px;
      padding: 16px;
    }
    .card {
      position: relative;
      background: #fff;
      overflow: hidden;
      border: 1px solid #F2F2F2;
      border-radius: 16px;
      height: 300px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      padding: 24px;
      opacity: 0;
      transform: translateX(20px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .card.show {
      opacity: 1;
      transform: translateX(0);
    }
    .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
    }
    .card-content.final h3:first-child {
      font-size: 14px;
      color: #554D59;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .card-content.final h3:nth-child(2) {
      font-size: 24px;
      font-weight: 900;
      text-transform: uppercase;
      color: #AC5FD9;
      margin-bottom: 8px;
    }
    .card-content h3 {
      color: #554D59;
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 8px;
      text-transform: uppercase;
      text-align: center;
    }
    .description, .status {
      margin-top: 4px;
      font-size: 14px;
      color: #444;
      text-align: center;
    }
    button {
      padding: 8px;
      margin: 4px 0;
      background: #fff;
      color: #AC5FD9;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 800;
      width: 192px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: opacity 0.4s ease;
      z-index: 2;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .progress-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      z-index: 2;
    }
    .progress-segment {
      flex: 1;
      height: 8px;
      background: #FCFCFC;
      border-radius: 4px;
    }
    .progress-segment.filled {
      background: #C9FFE3;
    }
    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      opacity: 1;
      animation: explode 3s ease-out forwards;
      pointer-events: none;
      z-index: 1;
    }
    @keyframes explode {
      0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
      100% { transform: translate(var(--dx), var(--dy)) scale(0.5); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="cards"></div>
  <script>
    const delay = 15;
    const finalDelay = 15;
    let step = +localStorage.stepIndex || 0;
    let start = +localStorage.stepStart || Date.now();
    const save = () => { localStorage.stepIndex = step; localStorage.stepStart = start; };
    const clearAll = () => {
      clearInterval(window.timer);
      clearInterval(window.finalTimer);
      clearInterval(window.confettiInterval);
    };
    const reset = () => { clearAll(); step = 0; start = Date.now(); save(); render(); };
    const progressBar = (container) => {
      const bar = document.createElement('div');
      bar.className = 'progress-bar';
      for (let i = 0; i < 3; i++) {
        const seg = document.createElement('div');
        seg.className = 'progress-segment' + (i < step ? ' filled' : '');
        bar.append(seg);
      }
      container.append(bar);
    };
    function spawnConfetti(parent, x, y) {
      for (let i = 0; i < 5; i++) {
        const dot = document.createElement('div');
        dot.className = 'confetti';
        const angle = Math.random()*2*Math.PI;
        const dist = 60 + Math.random()*20;
        dot.style.setProperty('--dx', `${Math.cos(angle)*dist}px`);
        dot.style.setProperty('--dy', `${Math.sin(angle)*dist}px`);
        dot.style.left = `${x}px`;
        dot.style.top = `${y}px`;
        dot.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 60%)`;
        parent.append(dot);
        setTimeout(() => dot.remove(), 3000);
      }
    }
    function launchConfetti(el) {
      const r = el.getBoundingClientRect();
      const x = r.left + r.width/2;
      const y = r.top + r.height/2 + window.scrollY;
      window.confettiInterval = setInterval(() => spawnConfetti(document.body, x, y), 4000);
    }
    function render() {
      clearAll();
      const root = document.getElementById('cards');
      root.innerHTML = '';
      if (step > 3) return reset();
      const card = document.createElement('div');
      card.className = 'card';
      progressBar(card);
      const content = document.createElement('div');
      content.className = 'card-content' + (step === 3 ? ' final' : '');
      // final step
      if (step === 3) {
        const t1 = document.createElement('h3');
        t1.textContent = 'Your Offer Is Ready';
        content.append(t1);
        const t2 = document.createElement('h3');
        t2.textContent = "🎉 LET'S GOOO!";
        content.append(t2);
        const d1 = document.createElement('div');
        d1.className = 'description';
        d1.textContent = 'Show the crew this screen before';
        content.append(d1);
        const st = document.createElement('div');
        st.className = 'status';
        content.append(st);
        card.append(content);
        root.append(card);
        requestAnimationFrame(() => card.classList.add('show'));
        launchConfetti(t2);
        // initial display
        (function updateFinal() {
          const r = finalDelay - Math.floor((Date.now() - start)/1000);
          if (r > 0) st.textContent = `🎉 0 H - 0 M - ${r} S`;
          else reset();
        })();
        window.finalTimer = setInterval(() => {
          const r = finalDelay - Math.floor((Date.now() - start)/1000);
          if (r > 0) st.textContent = `🎉 0 H - 0 M - ${r} S`;
          else reset();
        },1000);
        return;
      }
      // intermediate steps
      const title = document.createElement('h3');
      title.textContent = `Visit ${step+1}`;
      content.append(title);
      const elapsed = Math.floor((Date.now() - start)/1000);
      const desc = document.createElement('div');
      desc.className = 'description';
      if (step===0) desc.textContent = 'Check in for your first visit.';
      else if (step===1) desc.textContent = elapsed<delay ? 'You can check in again after' : 'Check in for your second visit.';
      else desc.textContent = elapsed<delay ? 'You can claim your offer in' : 'Check in to claim your offer.';
      content.append(desc);
      // only show counter if still waiting
      let status;
      if (step>0 && elapsed<delay) {
        status = document.createElement('div');
        status.className = 'status';
        status.textContent = `⏳ 0 H - 0 M - ${delay-elapsed} S`;
        content.append(status);
      }
      const btn = document.createElement('button');
      btn.textContent = 'Check In';
      btn.disabled = (step>0 && elapsed<delay);
      content.append(btn);
      btn.addEventListener('click',() => {
        clearAll(); step++; start = Date.now(); save(); render();
      });
      // start countdown if needed
      if (step>0 && elapsed<delay) {
        window.timer = setInterval(() => {
          const r = delay - Math.floor((Date.now() - start)/1000);
          if (r > 0) status.textContent = `⏳ 0 H - 0 M - ${r} S`;
          else {
            clearInterval(window.timer);
            status.remove();
            btn.disabled = false;
          }
        },1000);
      }
      card.append(content);
      root.append(card);
      requestAnimationFrame(()=>card.classList.add('show'));
    }
    if (!localStorage.stepStart) save();
    render();
  </script>
</body>
</html>
